<section class="admin-page">
	<header class="admin-header">
		<div>
			<p class="eyebrow">Gestion projets</p>
			<h1>Projets & études de cas</h1>
			<p class="lead">{{ publishedCount() }} projets publiés</p>
		</div>
		<div class="lang-toggle" role="group" aria-label="Langue du formulaire">
			<button type="button" class="toggle-btn" [class.is-active]="activeLang() === 'fr'" (click)="setLang('fr')">FR</button>
			<button type="button" class="toggle-btn" [class.is-active]="activeLang() === 'en'" (click)="setLang('en')">EN</button>
		</div>
	</header>

	<div class="admin-grid">
		<form class="admin-form" [formGroup]="projectForm" (ngSubmit)="addProject()">
			<h2>{{ editingId() ? 'Modifier le projet' : 'Ajouter un projet' }}</h2>

			<div class="field-row">
				<div class="field">
					<label for="status">Statut</label>
					<select id="status" formControlName="status">
						<option value="draft">Brouillon</option>
						<option value="published">Publié</option>
					</select>
				</div>
				<div class="field">
					<label for="sortIndex">Ordre d’affichage</label>
					<input id="sortIndex" type="number" min="1" formControlName="sortIndex" />
				</div>
			</div>

			@if (activeLang() === 'fr') {
				<div class="lang-panel" formGroupName="fr">
					<p class="lang-label">Version française</p>
					<div class="field">
						<label for="category-fr">Catégorie</label>
						<input id="category-fr" type="text" formControlName="category" />
					</div>
					<div class="field">
						<label for="title-fr">Titre</label>
						<input id="title-fr" type="text" formControlName="title" />
					</div>
					<div class="field-row">
						<div class="field">
							<label for="client-fr">Client / média</label>
							<input id="client-fr" type="text" formControlName="client" />
						</div>
						<div class="field">
							<label for="year-fr">Année</label>
							<input id="year-fr" type="text" formControlName="year" />
						</div>
					</div>
					<div class="field">
						<label for="context-fr">Contexte</label>
						<textarea id="context-fr" rows="3" formControlName="context"></textarea>
					</div>
					<div class="field">
						<label for="mission-fr">Mission</label>
						<textarea id="mission-fr" rows="3" formControlName="mission"></textarea>
					</div>
					<div class="field">
						<label for="deliverables-fr">Livrables (virgules)</label>
						<input id="deliverables-fr" type="text" formControlName="deliverables" />
					</div>
					<div class="field">
						<label for="results-fr">Résultats (virgules)</label>
						<input id="results-fr" type="text" formControlName="results" />
					</div>
				</div>
			} @else {
				<div class="lang-panel" formGroupName="en">
					<p class="lang-label">English version</p>
					<div class="field">
						<label for="category-en">Category</label>
						<input id="category-en" type="text" formControlName="category" />
					</div>
					<div class="field">
						<label for="title-en">Title</label>
						<input id="title-en" type="text" formControlName="title" />
					</div>
					<div class="field-row">
						<div class="field">
							<label for="client-en">Client</label>
							<input id="client-en" type="text" formControlName="client" />
						</div>
						<div class="field">
							<label for="year-en">Year</label>
							<input id="year-en" type="text" formControlName="year" />
						</div>
					</div>
					<div class="field">
						<label for="context-en">Context</label>
						<textarea id="context-en" rows="3" formControlName="context"></textarea>
					</div>
					<div class="field">
						<label for="mission-en">Mission</label>
						<textarea id="mission-en" rows="3" formControlName="mission"></textarea>
					</div>
					<div class="field">
						<label for="deliverables-en">Deliverables (comma)</label>
						<input id="deliverables-en" type="text" formControlName="deliverables" />
					</div>
					<div class="field">
						<label for="results-en">Results (comma)</label>
						<input id="results-en" type="text" formControlName="results" />
					</div>
				</div>
			}

			<div class="button-group">
				<button class="button primary" type="submit">
					{{ editingId() ? 'Enregistrer les modifications' : 'Ajouter' }}
				</button>
				@if (editingId()) {
					<button class="button ghost" type="button" (click)="cancelEdit()">Annuler</button>
				}
			</div>
		</form>

		<div class="list-panel">
			<h2>Projets enregistrés</h2>
			<ul>
				@for (project of projects(); track project.id) {
					<li [class.is-editing]="editingId() === project.id">
						<div class="project-info">
							<h3>{{ project.content[activeLang()].title }}</h3>
							<p class="meta">
								{{ project.content[activeLang()].client }} · {{ project.content[activeLang()].year }}
							</p>
							<p class="summary">{{ project.content[activeLang()].context }}</p>
							<span class="status" [class.is-published]="project.status === 'published'">
								{{ project.status === 'published' ? 'Publié' : 'Brouillon' }}
							</span>
						</div>
						<div class="project-actions">
							<button class="button ghost" type="button" (click)="togglePublish(project)">
								{{ project.status === 'published' ? 'Dépublier' : 'Publier' }}
							</button>
							<button class="button ghost" type="button" (click)="editProject(project)">
								Modifier
							</button>
							<button class="button ghost danger" type="button" (click)="removeProject(project)">
								Supprimer
							</button>
						</div>
					</li>
				}
			</ul>
		</div>
	</div>
</section>
